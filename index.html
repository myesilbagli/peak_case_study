<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <title>Peak Product Case – Q2 & Q4</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,600;0,9..40,700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0f0f12;
      --surface: #1a1a20;
      --border: #2a2a32;
      --text: #e8e8ec;
      --muted: #8888a0;
      --accent-a: #0ea5e9;
      --accent-b: #ef4444;
      --success: #4ade80;
      --highlight: #fbbf24;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'DM Sans', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }
    h1 {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 0.25rem 0;
      letter-spacing: -0.02em;
    }
    .subtitle {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 1.5rem;
    }
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.25rem 1.5rem;
      margin-bottom: 1.25rem;
    }
    .card h2 {
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--muted);
      margin: 0 0 0.75rem 0;
    }
    p {
      margin: 0 0 0.75rem 0;
      color: var(--muted);
      font-size: 0.95rem;
    }
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1rem;
    }
    .summary-box {
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--bg);
    }
    .summary-box .label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
      margin-bottom: 0.25rem;
    }
    .summary-box .value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1rem;
      font-weight: 600;
    }
    .summary-box.winner-a { border-color: var(--accent-a); background: rgba(14, 165, 233, 0.12); }
    .summary-box.winner-b { border-color: var(--accent-b); background: rgba(239, 68, 68, 0.12); }
    .chart-wrap {
      position: relative;
      height: 260px;
      margin-top: 0.5rem;
    }
    .cohort-tables {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
      margin-top: 0.75rem;
    }
    .cohort-wrap {
      overflow-x: auto;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg);
    }
    .cohort-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.75rem;
      font-family: 'JetBrains Mono', monospace;
    }
    .cohort-table th {
      padding: 0.4rem 0.35rem;
      text-align: right;
      background: var(--surface);
      color: var(--muted);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .cohort-table th.row-header {
      text-align: left;
      min-width: 4rem;
      left: 0;
      z-index: 2;
      background: var(--surface);
    }
    .cohort-table td {
      padding: 0.3rem 0.35rem;
      text-align: right;
      border-bottom: 1px solid var(--border);
      color: var(--text);
    }
    .cohort-table td.row-header {
      text-align: left;
      font-weight: 500;
      color: var(--muted);
      position: sticky;
      left: 0;
      background: var(--bg);
      z-index: 1;
    }
    .cohort-table tr:hover td.row-header { background: var(--surface); }
    .cohort-table tr:hover td { background: rgba(255,255,255,0.03); }
    .cohort-table td.empty { color: var(--border); }
    .cohort-table .col-day-15 { background: rgba(251, 191, 36, 0.08); font-weight: 600; }
    .cohort-table th.col-day-15 { background: rgba(251, 191, 36, 0.15); }
    .cohort-table tr.sum-row-day15 { background: rgba(14, 165, 233, 0.12); }
    .cohort-table tr.sum-row-day15 td { border-top: 2px solid var(--accent-a); }
    .cohort-table td.sum-day15 { background: rgba(14, 165, 233, 0.2); font-weight: 700; color: var(--accent-a); }
    #cohortTableB tr.sum-row-day15 { background: rgba(239, 68, 68, 0.12) !important; }
    #cohortTableB tr.sum-row-day15 td { border-top: 2px solid var(--accent-b) !important; }
    #cohortTableB td.sum-day15 { background: rgba(239, 68, 68, 0.2) !important; font-weight: 700; color: var(--accent-b) !important; }
    .footer {
      margin-top: 2rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
      font-size: 0.8rem;
      color: var(--muted);
    }

    .tab-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
      margin-bottom: 1.5rem;
      padding: 0.25rem 0;
      border-bottom: 1px solid var(--border);
    }
    .tab-btn {
      font-family: 'DM Sans', system-ui, sans-serif;
      font-size: 0.85rem;
      font-weight: 500;
      padding: 0.5rem 1rem;
      background: transparent;
      color: var(--muted);
      border: 1px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      transition: color 0.15s, background 0.15s, border-color 0.15s;
    }
    .tab-btn:hover {
      color: var(--text);
      background: var(--surface);
    }
    .tab-btn.active {
      color: var(--accent-a);
      background: rgba(14, 165, 233, 0.12);
      border-color: var(--accent-a);
    }
    .panel {
      display: none;
    }
    .panel.active {
      display: block;
    }
    .explain-block {
      background: var(--bg);
      border-radius: 8px;
      padding: 1rem 1.15rem;
      margin: 1rem 0;
      border-left: 3px solid var(--accent-a);
    }
    .explain-block h3 {
      font-size: 0.9rem;
      font-weight: 600;
      margin: 0 0 0.5rem 0;
      color: var(--text);
    }
    .explain-block p, .explain-block ul {
      margin: 0 0 0.5rem 0;
      font-size: 0.9rem;
      color: var(--muted);
      line-height: 1.6;
    }
    .explain-block ul { padding-left: 1.25rem; }
    .explain-block li { margin-bottom: 0.25rem; }
    .explain-block p:last-child { margin-bottom: 0; }
    .takeaway {
      font-weight: 600;
      color: var(--highlight);
      margin-top: 0.75rem;
    }
    .part-c-charts {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 0.75rem;
    }
    @media (max-width: 600px) { .part-c-charts { grid-template-columns: 1fr; } }

    .main-tab-bar {
      display: flex;
      gap: 0.5rem;
      padding: 1rem 1.5rem 0;
      max-width: 900px;
      margin: 0 auto;
      border-bottom: 1px solid var(--border);
    }
    .main-tab-btn {
      font-family: 'DM Sans', system-ui, sans-serif;
      font-size: 1rem;
      font-weight: 600;
      padding: 0.6rem 1.25rem;
      background: transparent;
      color: var(--muted);
      border: 1px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      transition: color 0.15s, background 0.15s, border-color 0.15s;
    }
    .main-tab-btn:hover { color: var(--text); background: var(--surface); }
    .main-tab-btn.active {
      color: var(--accent-a);
      background: rgba(14, 165, 233, 0.12);
      border-color: var(--accent-a);
    }
    .main-panel { display: none; }
    .main-panel.active { display: block; }

    .header-credit {
      position: fixed;
      top: 0;
      right: 0;
      padding: 0.75rem 1.25rem;
      text-align: center;
      z-index: 100;
      background: linear-gradient(to left, var(--bg) 70%, transparent);
    }
    .header-credit .peak-header-img {
      display: block;
      max-height: 36px;
      width: auto;
      margin: 0 auto 12px auto;
      object-fit: contain;
    }
    .header-credit .name { font-weight: 600; color: var(--text); font-size: 0.85rem; display: block; }
    .header-credit .date { font-size: 0.75rem; color: var(--muted); display: block; margin-top: 6px; }

    .q1-power-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin: 1rem 0;
    }
    .power-btn {
      font-family: 'DM Sans', system-ui, sans-serif;
      padding: 0.75rem 1rem;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      cursor: pointer;
      text-align: center;
      font-size: 0.9rem;
      font-weight: 600;
      transition: border-color 0.2s, background 0.2s;
    }
    .power-btn small { display: block; font-weight: 400; font-size: 0.75rem; color: var(--muted); margin-top: 0.25rem; }
    .power-btn:hover { border-color: var(--accent-a); background: rgba(14, 165, 233, 0.08); }
    .power-btn.active { border-color: var(--accent-a); background: rgba(14, 165, 233, 0.15); color: var(--accent-a); }
    .q1-selected { font-size: 0.9rem; color: var(--muted); margin-top: 0.5rem; }

    .board-wrap { margin-top: 0.5rem; }
    .board {
      display: inline-grid;
      grid-template-columns: repeat(9, 2.25rem);
      grid-template-rows: repeat(9, 2.25rem);
      gap: 3px;
      font-size: 0.7rem;
      font-family: 'JetBrains Mono', monospace;
    }
    .cell {
      width: 2.25rem;
      height: 2.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      background: var(--border);
      color: var(--muted);
      cursor: pointer;
      transition: background 0.15s;
      user-select: none;
    }
    .cell:hover { background: #3a3a45; color: var(--text); }
    .cell.combo { background: var(--accent-a); color: white; font-weight: 700; box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.6); }
    .cell.combo:hover { background: #0284c7; }
    .cell.affected { background: #0284c7; color: rgba(255,255,255,0.95); }
    .cell.affected:hover { background: #0ea5e9; }
    .cell.combo.affected { background: var(--accent-a); }
    .tiles-count { margin-top: 1rem; font-size: 1.1rem; font-weight: 600; color: var(--text); }
    .tiles-count .num { font-family: 'JetBrains Mono', monospace; color: var(--highlight); }
    .tiles-count .hint { font-weight: 400; font-size: 0.9rem; color: var(--muted); }
    .expected-note { margin-top: 1rem; font-size: 0.85rem; color: var(--muted); }
  </style>
</head>
<body>
  <div class="header-credit">
    <img src="peak header.png" alt="Peak" class="peak-header-img" />
    <span class="name">Muhyiddin Yesilbagli <small style="font-weight:400; color: var(--muted);">v.1</small></span><br>
    <span class="date">February 2026</span>
  </div>
  <div class="main-tab-bar">
    <button type="button" class="main-tab-btn" data-main-tab="q1">Q1 – Gardenscapes</button>
    <button type="button" class="main-tab-btn active" data-main-tab="q2">Q2 – 7×7 Combo</button>
    <button type="button" class="main-tab-btn" data-main-tab="q4">Q4 – A/B Metrics</button>
  </div>

  <div id="main-panel-q1" class="main-panel">
    <div class="container" style="max-width: 720px;">
      <h1>Q1 – Gardenscapes Power-ups</h1>
      <p class="subtitle">Peak Product Case · Square minus corners (Gardenscapes blast shape)</p>
      <div class="card">
        <h2>Select a power-up, then click a tile</h2>
        <p>Gardenscapes uses <strong>square minus corners</strong>: the blast is the (2r+1)×(2r+1) square centered on the tile, with the <strong>four corner cells removed</strong>. So radius 1 → 3×3−4 = 5 cells; radius 2 → 5×5−4 = 21; radius 3 → 7×7−4 = 45; radius 4 → 9×9−4 = 77. Pick one below, then click any tile.</p>
        <div class="q1-power-buttons">
          <button type="button" class="power-btn" data-power="firecracker" data-radius="1">Firecracker<br><small>1×1 radius (5 cells max)</small></button>
          <button type="button" class="power-btn" data-power="bomb" data-radius="2">Bomb<br><small>2×2 radius (21 cells max)</small></button>
          <button type="button" class="power-btn" data-power="dynamite" data-radius="3">Dynamite<br><small>3×3 radius (45 cells max)</small></button>
          <button type="button" class="power-btn" data-power="tnt" data-radius="4">TNT<br><small>4×4 radius (77 cells max)</small></button>
        </div>
        <p class="q1-selected" id="q1Selected">Select a power-up above, then click a tile on the board.</p>
        <div class="board-wrap" style="margin-top: 1rem;">
          <div class="board" id="boardQ1"></div>
          <p class="tiles-count" id="tilesCountQ1"></p>
        </div>
      </div>
      <div class="footer">Blast = (2r+1)×(2r+1) square minus the 4 corners. Firecracker 1, Bomb 2, Dynamite 3, TNT 4.</div>
    </div>
  </div>

  <div id="main-panel-q2" class="main-panel active">
    <div class="container" style="max-width: 720px;">
      <h1>Q2 – 7×7 Combo on 9×9 Board</h1>
      <p class="subtitle">Peak Product Case · Click any tile to see the blast</p>
      <div class="card">
        <h2>Interactive board</h2>
        <p>The combo affects a <strong>7×7</strong> area centered on the chosen tile. Click any tile below — that tile is the combo center. The board will show which tiles explode (purple) and how many are cleared. Near the borders, fewer than 49 tiles explode.</p>
        <div class="board-wrap">
          <div class="board" id="board"></div>
          <p class="tiles-count" id="tilesCount">Click a tile to see how many tiles explode.</p>
          <p class="expected-note" id="expectedNote"></p>
        </div>
      </div>
      <div class="card">
        <h2>How the expected value ≈ 32.11 is calculated</h2>
        <p><strong>Setup:</strong> The combo cell is chosen <strong>uniformly at random</strong> among all 81 cells (each position has probability 1/81). The blast is a <strong>7×7</strong> area centered on that cell, clipped to the board.</p>
        <p><strong>Step 1:</strong> For each of the 81 possible combo positions, count how many cells the blast covers:</p>
        <ul style="margin: 0.5rem 0; padding-left: 1.25rem; color: var(--muted); font-size: 0.95rem;">
          <li>Center (e.g. row 4, col 4): full 7×7 fits → <strong>49</strong> cells</li>
          <li>Corner (e.g. 0,0): only 4×4 fits → <strong>16</strong> cells</li>
          <li>Edge: a 7×4 or 5×7 rectangle, etc. → between 16 and 49</li>
        </ul>
        <p><strong>Step 2:</strong> Add those 81 numbers. The total is <strong>2,601</strong> (you can check: e.g. corners contribute 16×4, edges contribute various amounts, center 49, etc.).</p>
        <p><strong>Step 3:</strong> Expected tiles cleared = total ÷ 81 = 2,601 ÷ 81 = <strong>32.11</strong>.</p>
        <p>So if the combo appears at a random tile each time, on average <strong>32.11 tiles</strong> are cleared per combo.</p>
      </div>
      <div class="footer">7×7 blast (center ±3 in each direction), clipped to the 9×9 board.</div>
    </div>
  </div>

  <div id="main-panel-q4" class="main-panel">
  <div class="container">
    <h1>Q4 – A/B Test Visualization</h1>
    <p class="subtitle">Peak Product Case · 10,000 installs/day · DAU, retention, revenue</p>

    <div class="tab-bar">
      <button type="button" class="tab-btn active" data-tab="general">General Analysis</button>
      <button type="button" class="tab-btn" data-tab="part-a">Part A</button>
      <button type="button" class="tab-btn" data-tab="part-b">Part B</button>
      <button type="button" class="tab-btn" data-tab="part-c">Part C</button>
      <button type="button" class="tab-btn" data-tab="part-d">Part D</button>
    </div>

    <!-- General Analysis -->
    <div id="panel-general" class="panel active">
      <div class="card">
        <h2>Retention (%) by day</h2>
        <p>Variant A has lower day-1 retention but flatter decay. Variant B starts higher but drops faster.</p>
        <div class="chart-wrap"><canvas id="chartRetention"></canvas></div>
      </div>
      <div class="card">
        <h2>DAU over time</h2>
        <p>Daily active users = 10,000 × [R(0) + R(1) + ... + R(day-1)] where R(0) = 100% (same-day installs). DAU includes all users active that day, including new installs. Day 15 is the Part A decision point.</p>
        <div class="chart-wrap"><canvas id="chartDAU"></canvas></div>
      </div>
      <div class="card">
        <h2>Cumulative revenue over time</h2>
        <p>ARPDAU = $0.50. Part B asks which variant has higher cumulative revenue by end of day 15.</p>
        <div class="chart-wrap"><canvas id="chartRevenue"></canvas></div>
      </div>
      <div class="card">
        <h2>Cohort tables – DAU contribution by install day</h2>
        <p><strong>Important:</strong> DAU includes same-day new installs. R(0) = 100% (users who install that day are active that day by definition).</p>
        <p>Each row is a cohort (install day). Each column is a calendar day. Cell = that cohort’s contribution to DAU on that day (10,000 × retention). Column 15 highlighted for Part A.</p>
        <div class="cohort-tables">
          <div>
            <div class="cohort-wrap">
              <table class="cohort-table" id="cohortTableA">
                <caption style="text-align:left; padding:0.5rem 0; color: var(--accent-a); font-weight: 600;">Variant A</caption>
              </table>
            </div>
          </div>
          <div>
            <div class="cohort-wrap">
              <table class="cohort-table" id="cohortTableB">
                <caption style="text-align:left; padding:0.5rem 0; color: var(--accent-b); font-weight: 600;">Variant B</caption>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Part A -->
    <div id="panel-part-a" class="panel">
      <div class="card">
        <h2>Part A – Maximize DAU on day 15</h2>

        <div class="explain-block">
          <h3>What are we even asking?</h3>
          <p>We want to know: on <strong>day 15</strong>, which variant has <strong>more people opening the app that day</strong>? That number is called DAU (Daily Active Users).</p>
        </div>

        <div class="explain-block">
          <h3>Where does day-15 DAU come from?</h3>
          <p>We add 10,000 new installs every day. So on day 15 we have 15 groups of users (cohorts):</p>
          <ul>
            <li>People who installed on <strong>day 1</strong> → on day 15 they’re age 14 (14 days since install) → R(14) still play.</li>
            <li>People who installed on <strong>day 2</strong> → on day 15 they’re age 13 → R(13) still play.</li>
            <li>… same for day 3, 4, … 14.</li>
            <li>People who installed on <strong>day 15</strong> → on day 15 they’re age 0 (same day) → R(0) = 100% (all new installs are active that day).</li>
          </ul>
          <p>So <strong>DAU on day 15</strong> = 10,000 × [R(0) + R(1) + R(2) + … + R(14)] = 10,000 × [1.0 + R(1) + R(2) + … + R(14)]. We include same-day installs (R(0)=100%) plus returning users.</p>
        </div>

        <div class="explain-block">
          <h3>Mathematical Solution</h3>
          <p><strong>Step 1: Define the retention model</strong></p>
          <p>We use an exponential retention model:</p>
          <p style="font-family: 'JetBrains Mono', monospace; background: var(--surface); padding: 1rem; border-radius: 6px; margin: 0.5rem 0;">
            R(x) = exp(a + b × x)
          </p>
          <p>Where:</p>
          <ul>
            <li><strong>x</strong> = age (days since install)</li>
            <li><strong>R(0)</strong> = 1.0 (100% — same-day installs are always active)</li>
            <li>For <strong>Variant A</strong>: a = -0.9002646189, b = -0.006662949885</li>
            <li>For <strong>Variant B</strong>: a = -0.7983944203, b = -0.02019936859</li>
          </ul>

          <p><strong>Step 2: Calculate DAU on day 15</strong></p>
          <p>DAU on day t is the sum of contributions from all cohorts active that day:</p>
          <p style="font-family: 'JetBrains Mono', monospace; background: var(--surface); padding: 1rem; border-radius: 6px; margin: 0.5rem 0;">
            DAU(t) = I × Σ<sub>k=0</sub><sup>t-1</sup> R(k)
          </p>
          <p>Where:</p>
          <ul>
            <li><strong>I</strong> = 10,000 (daily installs)</li>
            <li><strong>k</strong> = age (0 to t-1)</li>
            <li><strong>R(k)</strong> = retention at age k</li>
          </ul>

          <p><strong>Step 3: Apply to day 15</strong></p>
          <p>For day 15, we sum retention from age 0 to age 14:</p>
          <p style="font-family: 'JetBrains Mono', monospace; background: var(--surface); padding: 1rem; border-radius: 6px; margin: 0.5rem 0;">
            DAU(15) = 10,000 × [R(0) + R(1) + R(2) + ... + R(14)]
          </p>
          <p style="font-family: 'JetBrains Mono', monospace; background: var(--surface); padding: 1rem; border-radius: 6px; margin: 0.5rem 0;">
            DAU(15) = 10,000 × [1.0 + exp(a + b×1) + exp(a + b×2) + ... + exp(a + b×14)]
          </p>

          <p><strong>Step 4: Calculate for each variant</strong></p>
          <p>Using the exponential model:</p>
          <ul>
            <li><strong>Variant A</strong>: DAU(15) = 10,000 × Σ<sub>k=0</sub><sup>14</sup> exp(-0.9002646189 - 0.006662949885×k)</li>
            <li><strong>Variant B</strong>: DAU(15) = 10,000 × Σ<sub>k=0</sub><sup>14</sup> exp(-0.7983944203 - 0.02019936859×k)</li>
          </ul>

          <p><strong>Step 5: Compare and choose</strong></p>
          <p>Calculate both values and pick the variant with higher DAU(15). The variant with better long-term retention (flatter decay curve) will have higher cumulative DAU by day 15, even if it starts lower.</p>
        </div>

        <div class="summary-grid">
          <div class="summary-box winner-a" id="partA">
            <div class="label">DAU on day 15</div>
            <div class="value" id="partAValue">—</div>
            <div class="label" style="margin-top:0.35rem;">Pick: <strong id="partAPick">—</strong></div>
          </div>
        </div>

        <div class="explain-block">
          <h3>Why does A win?</h3>
          <p>Variant B has <strong>higher retention at the start</strong> (e.g. 46% come back day 1 vs A’s 41%), but B’s retention <strong>drops faster</strong> over time. Variant A starts lower but <strong>holds on to people longer</strong>. By day 15 we’re adding up 15 cohorts; A’s “holds on longer” wins — more of those cohorts are still active, so total DAU is higher for A.</p>
          <p class="takeaway">Answer: Pick <strong id="partAPick2">—</strong>. See General Analysis for the DAU-over-time chart.</p>
        </div>
      </div>
    </div>

    <!-- Part B -->
    <div id="panel-part-b" class="panel">
      <div class="card">
        <h2>Part B – Maximize cumulative revenue by end of day 15</h2>

        <div class="explain-block">
          <h3>What are we asking?</h3>
          <p>This time the goal is <strong>money</strong>: by the end of day 15, which variant has made <strong>more total revenue</strong>? (We don’t care who wins on day 15 DAU — we care who made more cash in days 1–15 combined.)</p>
        </div>

        <div class="explain-block">
          <h3>How do we get revenue?</h3>
          <p>Each day: <strong>Revenue that day</strong> = (how many people played that day) × (how much we earn per active user). We’re told we earn <strong>$0.50 per active user per day</strong> (that’s ARPDAU). So:</p>
          <ul>
            <li>Day 1 revenue = DAU(1) × $0.50</li>
            <li>Day 2 revenue = DAU(2) × $0.50</li>
            <li>… same for every day up to 15.</li>
          </ul>
          <p><strong>Cumulative revenue by day 15</strong> = add up day 1 + day 2 + … + day 15 revenue.</p>
        </div>

        <div class="summary-grid">
          <div class="summary-box winner-b" id="partB">
            <div class="label">Cum. revenue by day 15</div>
            <div class="value" id="partBValue">—</div>
            <div class="label" style="margin-top:0.35rem;">Pick: <strong id="partBPick">—</strong></div>
          </div>
        </div>

        <div class="explain-block">
          <h3>Why does B win here (even though A won on day-15 DAU)?</h3>
          <p>B has <strong>stronger retention in the first days</strong> (way more people come back day 1, day 2, etc.). So in the <strong>first two weeks</strong>, B has higher DAU almost every day. More people playing = more revenue every day. We’re only counting revenue through day 15, so B’s “strong start” wins. A catches up later (that’s why A wins Part A), but that doesn’t help for “total money by day 15”.</p>
          <p class="takeaway">Answer: Pick <strong>B</strong>. See General Analysis for the cumulative revenue chart.</p>
        </div>
      </div>
    </div>

    <!-- Part C -->
    <div id="panel-part-c" class="panel">
      <div class="card">
        <h2>Part C – ARPDAU jump to $0.70, then drop back to $0.50</h2>

        <div class="explain-block">
          <h3>What’s different in this scenario?</h3>
          <p>Same installs and retention as before. From <strong>day 16</strong>, we earn <strong>$0.70 per active user</strong>; then ARPDAU drops by $0.02 each day to $0.52 by day 25:</p>
          <ul>
            <li>Days 1–15: $0.50 per active user.</li>
            <li>Day 16: $0.70; day 17: $0.68; day 18: $0.66; … day 25: $0.52.</li>
            <li>Day 26 onward: $0.50.</li>
          </ul>
          <p>The question: which variant has <strong>more total revenue from day 1 through day 25</strong>?</p>
        </div>

        <div class="card" style="margin-top: 1rem;">
          <h2>Part C – ARPDAU and revenue (your values)</h2>
          <p><strong>Top:</strong> ARPDAU from day 15 to 25 (jump to $0.70 on day 16, then linear drop to $0.52); day 26 onward $0.50. <strong>Middle:</strong> Daily revenue in the bonus window. <strong>Bottom:</strong> Cumulative revenue (day 15–25 window).</p>
          <div class="part-c-charts" style="grid-template-columns: 1fr;">
            <div>
              <p style="font-size: 0.8rem; color: var(--muted); margin-bottom: 0.35rem;">ARPDAU ($) — day 15 to 25</p>
              <div class="chart-wrap" style="height: 200px;"><canvas id="chartPartCArpdau"></canvas></div>
            </div>
            <div>
              <p style="font-size: 0.8rem; color: var(--muted); margin-bottom: 0.35rem;">Daily revenue ($) — day 15 to 25</p>
              <div class="chart-wrap" style="height: 200px;"><canvas id="chartPartCRevenue"></canvas></div>
            </div>
            <div>
              <p style="font-size: 0.8rem; color: var(--muted); margin-bottom: 0.35rem;">Cumulative revenue ($) — day 15 to 25</p>
              <div class="chart-wrap" style="height: 220px;"><canvas id="chartPartCCumulative"></canvas></div>
            </div>
          </div>
        </div>

        <div class="summary-grid">
          <div class="summary-box winner-a" id="partC">
            <div class="label">Cum. revenue day 1–25</div>
            <div class="value" id="partCValue">—</div>
            <div class="label" style="margin-top:0.35rem;">Pick: <strong id="partCPick">—</strong></div>
          </div>
        </div>

        <div class="explain-block">
          <h3>Why does A win?</h3>
          <p>The extra money ($0.70 instead of $0.50) is earned on <strong>every active user on those days</strong>. So whoever has <strong>more DAU in the period day 15–25</strong> gets more of that bonus. We already know A has higher DAU in the second half (that’s why A won Part A). So when we apply the higher ARPDAU to those days, A gets a bigger revenue bump than B. Total revenue day 1–25 is higher for A.</p>
          <p class="takeaway">Answer: Pick <strong>A</strong>.</p>
        </div>
      </div>
    </div>

    <!-- Part D -->
    <div id="panel-part-d" class="panel">
      <div class="card">
        <h2>Part D – New install source from day 15 (3k new + 7k old)</h2>

        <div class="explain-block">
          <h3>What’s different here?</h3>
          <p>We still have <strong>10,000 installs per day</strong>. But from day 15 on, those 10k are split:</p>
          <ul>
            <li><strong>7,000</strong> from the same source as before (same retention curves we’ve been using).</li>
            <li><strong>3,000</strong> from a <strong>new</strong> marketing source (e.g. a new ad channel).</li>
          </ul>
          <p>The new source has <strong>different retention</strong> for A vs B. For the 3k new users, A keeps them a bit longer than B (the math is given in the case). ARPDAU is still $0.50. The question: which variant has <strong>more total revenue from day 1 through day 28</strong>?</p>
        </div>

        <div class="explain-block">
          <h3>How we calculate it</h3>
          <p>For each day we compute DAU the same way, but:</p>
          <ul>
            <li>Users who installed <strong>before day 15</strong> → still 10k per day with the original retention.</li>
            <li>Users who installed <strong>on day 15 or later</strong> → 7k follow the old retention curve, 3k follow the new-source retention curve (different for A and B).</li>
          </ul>
          <p>Then we multiply each day’s DAU by $0.50 and add everything up through day 28.</p>
        </div>

        <div class="summary-grid">
          <div class="summary-box winner-a" id="partD">
            <div class="label">Cum. revenue day 1–28</div>
            <div class="value" id="partDValue">—</div>
            <div class="label" style="margin-top:0.35rem;">Pick: <strong id="partDPick">—</strong></div>
          </div>
        </div>

        <div class="explain-block">
          <h3>Why does A win?</h3>
          <p>For the <strong>3,000 new-source users each day</strong>, variant A’s retention drops more slowly than B’s. So those 3k users contribute more DAU (and thus more revenue) over time for A. The 7k old-source users behave as before; the difference comes from how long we keep the 3k new users. A keeps them longer → more revenue by day 28.</p>
          <p class="takeaway">Answer: Pick <strong>A</strong>.</p>
        </div>
      </div>
    </div>

    <div class="footer">
      Same logic as <code>q4_ab_metrics.py</code>. Retention fit: R(x) = (a·ln(x)+b)/100 from (day 1, day 28) points.
    </div>
  </div>
  </div>

  <script>
    // -------- Q1: Gardenscapes diamond explosions --------
    (function() {
      const N = 9;
      let selectedPower = null;
      let selectedQ1R = null, selectedQ1C = null;

      function getSquareMinusCornersSet(centerR, centerC, radius) {
        const set = new Set();
        for (let i = 0; i < N; i++) {
          for (let j = 0; j < N; j++) {
            const dr = Math.abs(i - centerR), dc = Math.abs(j - centerC);
            const inSquare = dr <= radius && dc <= radius;
            const isCorner = dr === radius && dc === radius;
            if (inSquare && !isCorner) set.add(i * N + j);
          }
        }
        return set;
      }

      function countSquareMinusCorners(centerR, centerC, radius) {
        let count = 0;
        for (let i = 0; i < N; i++) {
          for (let j = 0; j < N; j++) {
            const dr = Math.abs(i - centerR), dc = Math.abs(j - centerC);
            if (dr <= radius && dc <= radius && !(dr === radius && dc === radius)) count++;
          }
        }
        return count;
      }

      function renderBoardQ1() {
        const board = document.getElementById('boardQ1');
        const countEl = document.getElementById('tilesCountQ1');
        const selectedEl = document.getElementById('q1Selected');
        if (!board) return;
        const r = selectedPower ? parseInt(selectedPower.dataset.radius, 10) : 0;
        const hasCenter = selectedQ1R !== null && selectedQ1C !== null && selectedPower;
        const affected = hasCenter ? getSquareMinusCornersSet(selectedQ1R, selectedQ1C, r) : new Set();
        const count = hasCenter ? countSquareMinusCorners(selectedQ1R, selectedQ1C, r) : 0;

        board.innerHTML = '';
        for (let i = 0; i < N; i++) {
          for (let j = 0; j < N; j++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.row = i;
            cell.dataset.col = j;
            const idx = i * N + j;
            if (hasCenter && i === selectedQ1R && j === selectedQ1C) cell.classList.add('combo');
            if (hasCenter && affected.has(idx)) cell.classList.add('affected');
            cell.textContent = '';
            cell.title = 'Row ' + i + ', Col ' + j;
            board.appendChild(cell);
          }
        }

        if (selectedEl) {
          if (selectedPower) selectedEl.textContent = 'Selected: ' + selectedPower.dataset.power.charAt(0).toUpperCase() + selectedPower.dataset.power.slice(1) + '. Click a tile to set the blast center.';
          else selectedEl.textContent = 'Select a power-up above, then click a tile on the board.';
        }
        if (countEl) {
          if (hasCenter) countEl.innerHTML = '<span class="num">' + count + '</span> tile' + (count !== 1 ? 's' : '') + ' explode (square − corners, radius ' + r + ')';
          else countEl.textContent = '';
        }
      }

      document.querySelectorAll('.power-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.power-btn').forEach(function(b) { b.classList.remove('active'); });
          btn.classList.add('active');
          selectedPower = btn;
          selectedQ1R = null;
          selectedQ1C = null;
          renderBoardQ1();
        });
      });

      const boardQ1 = document.getElementById('boardQ1');
      if (boardQ1) {
        boardQ1.addEventListener('click', function(e) {
          const cell = e.target.closest('.cell');
          if (!cell || !selectedPower) return;
          selectedQ1R = parseInt(cell.dataset.row, 10);
          selectedQ1C = parseInt(cell.dataset.col, 10);
          renderBoardQ1();
        });
      }
      renderBoardQ1();
    })();

    // -------- Q2: 7×7 combo board --------
    (function() {
      const N = 9;
      const RADIUS = 3;
      function cellsAffected7x7(r, c) {
        const rLo = Math.max(0, r - RADIUS), rHi = Math.min(N - 1, r + RADIUS);
        const cLo = Math.max(0, c - RADIUS), cHi = Math.min(N - 1, c + RADIUS);
        return (rHi - rLo + 1) * (cHi - cLo + 1);
      }
      function getAffectedSet(comboR, comboC) {
        const set = new Set();
        const rLo = Math.max(0, comboR - RADIUS), rHi = Math.min(N - 1, comboR + RADIUS);
        const cLo = Math.max(0, comboC - RADIUS), cHi = Math.min(N - 1, comboC + RADIUS);
        for (let i = rLo; i <= rHi; i++)
          for (let j = cLo; j <= cHi; j++) set.add(i * N + j);
        return set;
      }
      function exactExpected7x7() {
        let total = 0;
        for (let i = 0; i < N; i++)
          for (let j = 0; j < N; j++) total += cellsAffected7x7(i, j);
        return total / (N * N);
      }
      function renderBoard(selectedR, selectedC) {
        const board = document.getElementById('board');
        if (!board) return;
        const hasSelection = selectedR !== null && selectedC !== null;
        const affected = hasSelection ? getAffectedSet(selectedR, selectedC) : new Set();
        const count = hasSelection ? cellsAffected7x7(selectedR, selectedC) : 0;
        board.innerHTML = '';
        for (let i = 0; i < N; i++) {
          for (let j = 0; j < N; j++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.row = i;
            cell.dataset.col = j;
            const idx = i * N + j;
            if (hasSelection && i === selectedR && j === selectedC) cell.classList.add('combo');
            if (hasSelection && affected.has(idx)) cell.classList.add('affected');
            cell.textContent = '';
            cell.title = 'Row ' + i + ', Col ' + j + '. Click to set as combo center.';
            board.appendChild(cell);
          }
        }
        const countEl = document.getElementById('tilesCount');
        const noteEl = document.getElementById('expectedNote');
        if (countEl) {
          if (hasSelection) countEl.innerHTML = '<span class="num">' + count + '</span> tile' + (count !== 1 ? 's' : '') + ' will explode <span class="hint">(combo at row ' + selectedR + ', col ' + selectedC + ')</span>';
          else countEl.textContent = 'Click a tile to see how many tiles explode.';
        }
        if (noteEl) noteEl.textContent = 'Expected tiles cleared (if combo is random): ' + exactExpected7x7().toFixed(2) + ' per combo.';
      }
      const boardEl = document.getElementById('board');
      if (boardEl) {
        boardEl.addEventListener('click', function(e) {
          const cell = e.target.closest('.cell');
          if (!cell) return;
          renderBoard(parseInt(cell.dataset.row, 10), parseInt(cell.dataset.col, 10));
        });
      }
      renderBoard(null, null);
    })();

    const INSTALLS = 10000;
    const ARPDAU = 0.50;

    // Exponential retention model: R(x) = exp(a + b * x)
    // Coefficients matching your spreadsheet (RetA age 1 = 0.4006375526, RetB age 1 = 0.4271033628)
    // Variant A: aA = -0.9109272487, bA = -0.003770870565
    // Variant B: aB = -0.8383393092, bB = -0.01238991841
    const A_COEFF_A = -0.9109272487;  // intercept
    const A_COEFF_B = -0.003770870565;  // slope
    const B_COEFF_A = -0.8383393092;  // intercept
    const B_COEFF_B = -0.01238991841;  // slope

    // Retention values for ages 0-28 (matches your retention table)
    const RETENTION_A = { 0: 1.0 };
    const RETENTION_B = { 0: 1.0 };
    for (let age = 1; age <= 28; age++) {
      RETENTION_A[age] = Math.exp(A_COEFF_A + A_COEFF_B * age);
      RETENTION_B[age] = Math.exp(B_COEFF_A + B_COEFF_B * age);
    }
    
    // Retention function: R(x) = exp(a + b * x)
    function R_A(x) {
      if (x === 0) return 1.0;
      if (RETENTION_A[x] !== undefined) return RETENTION_A[x];
      return Math.exp(A_COEFF_A + A_COEFF_B * x);
    }
    function R_B(x) {
      if (x === 0) return 1.0;
      if (RETENTION_B[x] !== undefined) return RETENTION_B[x];
      return Math.exp(B_COEFF_A + B_COEFF_B * x);
    }

    function dau(day, R) {
      // DAU includes same-day new installs: age 0 = R(0) = 1.0 (100%)
      // Day t DAU = sum of cohorts: age 0 (day t installs) + age 1 (day t-1 installs) + ... + age t-1 (day 1 installs)
      let sum = 1.0; // R(0) = 100% for same-day installs
      for (let k = 1; k < day; k++) sum += R(k); // R(1) to R(day-1)
      return INSTALLS * sum;
    }

    function cumRevenue(throughDay, R) {
      let total = 0;
      for (let d = 1; d <= throughDay; d++)
        total += dau(d, R) * ARPDAU;
      return total;
    }

    // Part C: ARPDAU from your spreadsheet — day 1–15: $0.50; day 16: $0.70; drop to $0.52 by day 25; after day 25: $0.50
    const ARPDAU_PART_C = {
      1: 0.50, 2: 0.50, 3: 0.50, 4: 0.50, 5: 0.50, 6: 0.50, 7: 0.50, 8: 0.50, 9: 0.50, 10: 0.50,
      11: 0.50, 12: 0.50, 13: 0.50, 14: 0.50, 15: 0.50,
      16: 0.70, 17: 0.68, 18: 0.66, 19: 0.64, 20: 0.62, 21: 0.60, 22: 0.58, 23: 0.56, 24: 0.54, 25: 0.52
    };
    function arpdauPartC(day) {
      if (day >= 1 && day <= 25 && ARPDAU_PART_C[day] !== undefined) return ARPDAU_PART_C[day];
      return 0.50; // day 26 onward: 50 cent ARPDAU
    }
    // Your Variant A daily revenue (day 1 to 28) — cumulative through day 25 = 796,760.83
    const DAILY_REV_A = [
      5000, 7003.19, 8998.84, 10986.97, 12967.63, 14940.83, 16906.60, 18864.97, 20815.98, 22759.64,
      24695.98, 26625.04, 28546.83, 30461.40, 32368.75, 47976.50, 49180.26, 50223.17, 51106.13, 51830.01,
      52395.70, 52804.07, 53056.00, 53152.35, 53093.99, 52881.77, 54704.74, 56520.85
    ];
    function cumRevenuePartC(throughDay, R) {
      if (R === R_A && throughDay >= 1 && throughDay <= 28) {
        let sum = 0;
        for (let d = 0; d < throughDay && d < DAILY_REV_A.length; d++) sum += DAILY_REV_A[d];
        return sum;
      }
      let total = 0;
      for (let d = 1; d <= throughDay; d++)
        total += dau(d, R) * arpdauPartC(d);
      return total;
    }

    // Part D: From day 15, 7k old + 3k new per day. New retention A: (-2.1*ln(x)+48)/100, B: (-5.1*ln(x)+53)/100
    const R_A_new = x => (x >= 1 ? (-2.1 * Math.log(x) + 48) / 100 : 0);
    const R_B_new = x => (x >= 1 ? (-5.1 * Math.log(x) + 53) / 100 : 0);
    const OLD_INSTALLS = 7000;
    const NEW_INSTALLS = 3000;
    const SWITCH_DAY = 15;

    function dauMixed(day, R_old, R_new) {
      let total = 0;
      for (let installDay = 1; installDay <= day; installDay++) {
        const age = day - installDay; // age = calendar_day - install_day
        if (age === 0) {
          // Same-day installs: R(0) = 1.0 (100%)
          if (installDay < SWITCH_DAY)
            total += INSTALLS * 1.0;
          else
            total += OLD_INSTALLS * 1.0 + NEW_INSTALLS * 1.0;
        } else {
          if (installDay < SWITCH_DAY)
            total += INSTALLS * R_old(age);
          else
            total += OLD_INSTALLS * R_old(age) + NEW_INSTALLS * R_new(age);
        }
      }
      return total;
    }
    function cumRevenuePartD(throughDay, R_old, R_new) {
      let total = 0;
      for (let d = 1; d <= throughDay; d++)
        total += dauMixed(d, R_old, R_new) * ARPDAU;
      return total;
    }

    const days = [];
    for (let i = 1; i <= 28; i++) days.push(i);

    // Use exact retention values for ages 0-14, then logarithmic fit for 15-28
    const retentionA = days.map(d => {
      const val = R_A(d);
      return Math.round(val * 10000) / 100;
    });
    const retentionB = days.map(d => {
      const val = R_B(d);
      return Math.round(val * 10000) / 100;
    });
    const dauA = days.map(d => dau(d, R_A));
    const dauB = days.map(d => dau(d, R_B));
    const cumRevA = days.map(d => cumRevenue(d, R_A));
    const cumRevB = days.map(d => cumRevenue(d, R_B));

    const dau15_A = dau(15, R_A);
    const dau15_B = dau(15, R_B);
    const rev15_A = cumRevenue(15, R_A);
    const rev15_B = cumRevenue(15, R_B);

    const partAPick = dau15_A >= dau15_B ? 'A' : 'B';
    const partBPick = rev15_A >= rev15_B ? 'A' : 'B';

    const rev25_A_c = cumRevenuePartC(25, R_A);
    const rev25_B_c = cumRevenuePartC(25, R_B);
    const partCPick = rev25_A_c >= rev25_B_c ? 'A' : 'B';

    const rev28_A_d = cumRevenuePartD(28, R_A, R_A_new);
    const rev28_B_d = cumRevenuePartD(28, R_B, R_B_new);
    const partDPick = rev28_A_d >= rev28_B_d ? 'A' : 'B';

    document.getElementById('partAValue').textContent =
      `A: ${dau15_A.toLocaleString(undefined, { maximumFractionDigits: 0 })} · B: ${dau15_B.toLocaleString(undefined, { maximumFractionDigits: 0 })}`;
    document.getElementById('partAPick').textContent = partAPick;
    const partAPick2El = document.getElementById('partAPick2');
    if (partAPick2El) partAPick2El.textContent = partAPick;
    document.getElementById('partBValue').textContent =
      `A: $${(rev15_A/1000).toFixed(0)}k · B: $${(rev15_B/1000).toFixed(0)}k`;
    document.getElementById('partBPick').textContent = partBPick;

    document.getElementById('partA').classList.remove('winner-a', 'winner-b');
    document.getElementById('partA').classList.add(partAPick === 'A' ? 'winner-a' : 'winner-b');
    document.getElementById('partB').classList.remove('winner-a', 'winner-b');
    document.getElementById('partB').classList.add(partBPick === 'A' ? 'winner-a' : 'winner-b');

    document.getElementById('partCValue').textContent =
      'A: $' + (rev25_A_c/1000).toFixed(0) + 'k · B: $' + (rev25_B_c/1000).toFixed(0) + 'k';
    document.getElementById('partCPick').textContent = partCPick;
    document.getElementById('partC').classList.remove('winner-a', 'winner-b');
    document.getElementById('partC').classList.add(partCPick === 'A' ? 'winner-a' : 'winner-b');

    document.getElementById('partDValue').textContent =
      'A: $' + (rev28_A_d/1000).toFixed(0) + 'k · B: $' + (rev28_B_d/1000).toFixed(0) + 'k';
    document.getElementById('partDPick').textContent = partDPick;
    document.getElementById('partD').classList.remove('winner-a', 'winner-b');
    document.getElementById('partD').classList.add(partDPick === 'A' ? 'winner-a' : 'winner-b');

    function buildCohortTable(R, maxDay) {
      let html = '<thead><tr><th class="row-header">Cohort</th>';
      for (let d = 1; d <= maxDay; d++)
        html += '<th class="' + (d === 15 ? 'col-day-15' : '') + '">' + d + '</th>';
      html += '</tr></thead><tbody>';
      
      // Store column 15 values for sum calculation
      const col15Values = [];
      
      for (let installDay = 1; installDay <= maxDay; installDay++) {
        html += '<tr><td class="row-header">Day ' + installDay + '</td>';
        for (let calDay = 1; calDay <= maxDay; calDay++) {
          const age = calDay - installDay; // age = calendar_day - install_day (no +1)
          const cls = (calDay === 15 ? ' col-day-15' : '') + (age < 0 ? ' empty' : '');
          let val;
          if (age < 0) {
            val = '—';
          } else if (age === 0) {
            val = INSTALLS.toLocaleString(undefined, { maximumFractionDigits: 0 }); // R(0) = 1.0 = 100%
          } else {
            val = (INSTALLS * R(age)).toLocaleString(undefined, { maximumFractionDigits: 0 });
          }
          
          // Store column 15 values for sum
          if (calDay === 15 && age >= 0) {
            col15Values.push(age === 0 ? INSTALLS : INSTALLS * R(age));
          }
          
          html += '<td class="' + cls.trim() + '">' + val + '</td>';
        }
        html += '</tr>';
      }
      
      // Add sum row for day 15
      const sum15 = col15Values.reduce((a, b) => a + b, 0);
      html += '<tr class="sum-row-day15"><td class="row-header"><strong>Sum (Day 15)</strong></td>';
      for (let calDay = 1; calDay <= maxDay; calDay++) {
        if (calDay === 15) {
          html += '<td class="sum-day15"><strong>' + sum15.toLocaleString(undefined, { maximumFractionDigits: 0 }) + '</strong></td>';
        } else {
          html += '<td></td>';
        }
      }
      html += '</tr>';
      
      html += '</tbody>';
      return html;
    }

    document.getElementById('cohortTableA').innerHTML += buildCohortTable(R_A, 15);
    document.getElementById('cohortTableB').innerHTML += buildCohortTable(R_B, 15);

    const gridColor = 'rgba(136, 136, 160, 0.2)';
    const fontColor = '#e8e8ec';
    const fontMuted = '#8888a0';

    let chartRetention, chartDAU, chartRevenue, chartPartCArpdau, chartPartCRevenue, chartPartCCumulative;

    chartRetention = new Chart(document.getElementById('chartRetention'), {
      type: 'line',
      data: {
        labels: days,
        datasets: [
          { label: 'Variant A', data: retentionA, borderColor: '#0ea5e9', backgroundColor: 'rgba(14, 165, 233, 0.1)', fill: true, tension: 0.2, pointRadius: 0 },
          { label: 'Variant B', data: retentionB, borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', fill: true, tension: 0.2, pointRadius: 0 }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { labels: { color: fontColor } } },
        scales: {
          x: { grid: { color: gridColor }, ticks: { color: fontMuted, maxTicksLimit: 14 } },
          y: { grid: { color: gridColor }, ticks: { color: fontMuted }, min: 30, max: 50 }
        }
      }
    });

    chartDAU = new Chart(document.getElementById('chartDAU'), {
      type: 'line',
      data: {
        labels: days,
        datasets: [
          { label: 'Variant A', data: dauA, borderColor: '#0ea5e9', backgroundColor: 'rgba(14, 165, 233, 0.08)', fill: true, tension: 0.2, pointRadius: 0 },
          { label: 'Variant B', data: dauB, borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.08)', fill: true, tension: 0.2, pointRadius: 0 }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { labels: { color: fontColor } },
          tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + Math.round(ctx.raw).toLocaleString() } }
        },
        scales: {
          x: { grid: { color: gridColor }, ticks: { color: fontMuted, maxTicksLimit: 14 } },
          y: { grid: { color: gridColor }, ticks: { color: fontMuted, callback: v => v >= 1000 ? (v/1000)+'k' : v } }
        }
      },
      plugins: [{
        id: 'vline15',
        beforeDraw(chart) {
          const ctx = chart.ctx;
          const xAxis = chart.scales.x;
          const x = xAxis.getPixelForValue(15);
          if (x < chart.chartArea.left || x > chart.chartArea.right) return;
          ctx.save();
          ctx.strokeStyle = 'rgba(251, 191, 36, 0.7)';
          ctx.lineWidth = 2;
          ctx.setLineDash([5, 5]);
          ctx.beginPath();
          ctx.moveTo(x, chart.chartArea.top);
          ctx.lineTo(x, chart.chartArea.bottom);
          ctx.stroke();
          ctx.restore();
          ctx.fillStyle = 'rgba(251, 191, 36, 0.7)';
          ctx.font = '11px DM Sans';
          ctx.fillText('day 15', x + 4, chart.chartArea.top + 12);
        }
      }]
    });

    chartRevenue = new Chart(document.getElementById('chartRevenue'), {
      type: 'line',
      data: {
        labels: days,
        datasets: [
          { label: 'Variant A', data: cumRevA, borderColor: '#0ea5e9', backgroundColor: 'rgba(14, 165, 233, 0.08)', fill: true, tension: 0.2, pointRadius: 0 },
          { label: 'Variant B', data: cumRevB, borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.08)', fill: true, tension: 0.2, pointRadius: 0 }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { labels: { color: fontColor } },
          tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': $' + Math.round(ctx.raw).toLocaleString() } }
        },
        scales: {
          x: { grid: { color: gridColor }, ticks: { color: fontMuted, maxTicksLimit: 14 } },
          y: { grid: { color: gridColor }, ticks: { color: fontMuted, callback: v => '$' + (v/1000) + 'k' } }
        }
      },
      plugins: [{
        id: 'vline15rev',
        beforeDraw(chart) {
          const ctx = chart.ctx;
          const xAxis = chart.scales.x;
          const x = xAxis.getPixelForValue(15);
          if (x < chart.chartArea.left || x > chart.chartArea.right) return;
          ctx.save();
          ctx.strokeStyle = 'rgba(251, 191, 36, 0.7)';
          ctx.lineWidth = 2;
          ctx.setLineDash([5, 5]);
          ctx.beginPath();
          ctx.moveTo(x, chart.chartArea.top);
          ctx.lineTo(x, chart.chartArea.bottom);
          ctx.stroke();
          ctx.restore();
          ctx.fillStyle = 'rgba(251, 191, 36, 0.7)';
          ctx.font = '11px DM Sans';
          ctx.fillText('day 15', x + 4, chart.chartArea.top + 12);
        }
      }]
    });

    // Part C: focus on days 15–25 (ARPDAU bump); Variant A uses your daily revenue data
    const days15to25 = [];
    for (let i = 15; i <= 25; i++) days15to25.push(i);
    const arpdauC = days15to25.map(d => arpdauPartC(d));
    const dailyRevA_C = days15to25.map(d => DAILY_REV_A[d - 1]);
    const dailyRevB_C = days15to25.map(d => dau(d, R_B) * arpdauPartC(d));

    chartPartCArpdau = new Chart(document.getElementById('chartPartCArpdau'), {
      type: 'line',
      data: {
        labels: days15to25,
        datasets: [{
          label: 'ARPDAU ($)',
          data: arpdauC,
          borderColor: '#fbbf24',
          backgroundColor: 'rgba(251, 191, 36, 0.15)',
          fill: true,
          tension: 0,
          pointRadius: 3,
          pointHoverRadius: 5
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { labels: { color: fontColor } } },
        scales: {
          x: { grid: { color: gridColor }, ticks: { color: fontMuted } },
          y: {
            grid: { color: gridColor },
            ticks: { color: fontMuted, callback: v => '$' + v.toFixed(2) },
            min: 0.45,
            max: 0.75
          }
        }
      }
    });

    chartPartCRevenue = new Chart(document.getElementById('chartPartCRevenue'), {
      type: 'line',
      data: {
        labels: days15to25,
        datasets: [
          { label: 'Variant A', data: dailyRevA_C, borderColor: '#0ea5e9', backgroundColor: 'rgba(14, 165, 233, 0.1)', fill: true, tension: 0.2, pointRadius: 2 },
          { label: 'Variant B', data: dailyRevB_C, borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', fill: true, tension: 0.2, pointRadius: 2 }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { labels: { color: fontColor } },
          tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': $' + Math.round(ctx.raw).toLocaleString() } }
        },
        scales: {
          x: { grid: { color: gridColor }, ticks: { color: fontMuted } },
          y: { grid: { color: gridColor }, ticks: { color: fontMuted, callback: v => '$' + (v/1000).toFixed(0) + 'k' } }
        }
      }
    });

    // Part C: Cumulative revenue — chart shows only day 15 to 25 (bonus window); A from your daily revenues
    const days15to25Cum = [];
    for (let i = 15; i <= 25; i++) days15to25Cum.push(i);
    const cumRevA_PartC_15_25 = days15to25Cum.map(d => cumRevenuePartC(d, R_A));
    const cumRevB_PartC_15_25 = days15to25Cum.map(d => cumRevenuePartC(d, R_B));

    chartPartCCumulative = new Chart(document.getElementById('chartPartCCumulative'), {
      type: 'line',
      data: {
        labels: days15to25Cum,
        datasets: [
          { label: 'Variant A', data: cumRevA_PartC_15_25, borderColor: '#0ea5e9', backgroundColor: 'rgba(14, 165, 233, 0.1)', fill: true, tension: 0.2, pointRadius: 2 },
          { label: 'Variant B', data: cumRevB_PartC_15_25, borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', fill: true, tension: 0.2, pointRadius: 2 }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { labels: { color: fontColor } },
          tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': $' + Math.round(ctx.raw).toLocaleString() } }
        },
        scales: {
          x: { grid: { color: gridColor }, ticks: { color: fontMuted } },
          y: { grid: { color: gridColor }, ticks: { color: fontMuted, callback: v => '$' + (v/1000).toFixed(0) + 'k' } }
        }
      }
    });

    function showPanel(tabId) {
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      const panel = document.getElementById('panel-' + tabId);
      const btn = document.querySelector('.tab-btn[data-tab="' + tabId + '"]');
      if (panel) panel.classList.add('active');
      if (btn) btn.classList.add('active');
      if (tabId === 'general' && chartRetention && chartDAU && chartRevenue) {
        setTimeout(function() {
          chartRetention.resize();
          chartDAU.resize();
          chartRevenue.resize();
        }, 50);
      }
      if (tabId === 'part-c' && chartPartCArpdau && chartPartCRevenue && chartPartCCumulative) {
        setTimeout(function() {
          chartPartCArpdau.resize();
          chartPartCRevenue.resize();
          chartPartCCumulative.resize();
        }, 50);
      }
    }

    document.querySelectorAll('.tab-btn').forEach(function(btn) {
      btn.addEventListener('click', function() {
        showPanel(btn.getAttribute('data-tab'));
      });
    });

    function resizeQ4Charts() {
      if (typeof chartRetention !== 'undefined' && chartRetention) chartRetention.resize();
      if (typeof chartDAU !== 'undefined' && chartDAU) chartDAU.resize();
      if (typeof chartRevenue !== 'undefined' && chartRevenue) chartRevenue.resize();
      if (typeof chartPartCArpdau !== 'undefined' && chartPartCArpdau) chartPartCArpdau.resize();
      if (typeof chartPartCRevenue !== 'undefined' && chartPartCRevenue) chartPartCRevenue.resize();
      if (typeof chartPartCCumulative !== 'undefined' && chartPartCCumulative) chartPartCCumulative.resize();
    }

    document.querySelectorAll('.main-tab-btn').forEach(function(btn) {
      btn.addEventListener('click', function() {
        const tab = btn.getAttribute('data-main-tab');
        document.querySelectorAll('.main-tab-btn').forEach(function(b) { b.classList.remove('active'); });
        document.querySelectorAll('.main-panel').forEach(function(p) { p.classList.remove('active'); });
        btn.classList.add('active');
        const panel = document.getElementById('main-panel-' + tab);
        if (panel) panel.classList.add('active');
        if (tab === 'q4') setTimeout(resizeQ4Charts, 100);
      });
    });
  </script>
</body>
</html>
